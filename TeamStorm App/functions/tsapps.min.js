function setCookie(e,t,o){var a=new Date;a.setTime(a.getTime()+24*o*60*60*1e3);var s="expires="+a.toGMTString();document.cookie=e+"="+t+"; "+s}function loadaddress(){getaddressbook(),document.getElementById("addressall").innerHTML=window.localStorage.getItem("latestcontacts"),delete loadaddress}function hideMessagefeed(){document.getElementById("feednotif").style.display="none"}function getnewsfeed(e){var t="";checkConnection()>2?$.ajax({type:"post",async:e,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/newsfeed",data:{sid:ses_id,mypost:0,itemperpage:7},success:function(e){if(nextpagedate=e.nextpage_date,e.items>0)for(var o=0;o<e.items;o++){var a,s=e.feeds[o].id,n=e.feeds[o].poster_id,i=e.feeds[o].poster_name,l=e.feeds[o].date_posted,c=e.feeds[o].post_mood,d=e.feeds[o].project_id,r=e.feeds[o].task_id,m=e.feeds[o].to_user_id,p=e.feeds[o].title,u=e.feeds[o].content,g=e.feeds[o].agree_count,f=e.feeds[o].comment_count,y=e.feeds[o].location,_=e.feeds[o].is_agree,h="";if(getposterpic(n),d>0&&(h=' posted in <a ontouchstart="projectinfo('+d+');"  >'+p+"</a>"),m>0&&m!=localStorage.getItem("ts_myid")){getnfeeduserinfo(m);var b=getnfeeduname;h='<i class="flaticon-arrow-right"></i> <a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+m+');" >'+b+"</a>"}switch(r>0&&(h=' posted on task <a data-toggle="modal" href="#taskinfo" ontouchstart="getmytaskinfo('+d+","+r+');" >'+gettaskname(d,r)+"</a>"),t+='<div class="inner-wrapper" id ="newsfeed-'+s+'"><div class="main-user-post"><div class="media"><a class="pull-left" data-toggle="modal" href="#userprof"  ontouchstart="userprofile('+n+');"  ><img class="media-object img-circle" src="data:image/gif;base64,'+getnfeedprofpic+'" width="50" height="50" alt="Image"></a><div class="media-body">',n==localStorage.getItem("ts_myid")&&(t+='<div class="btn-group pull-right" ><span class="ico flaticon-arrow-bottom dropdown-toggle" data-toggle="modal" href="#postsettings" ontouchstart="postsettings('+s+')"></span></div>'),t+='<h4 class="media-heading"><a data-toggle="modal" href="#userprof"  ontouchstart="userprofile('+n+');" >'+i+"</a>"+h+" </h4><small>"+l+"</small>",c){case"1":t+=' <span class="ico flaticon-lamp"></span>';break;case"2":t+=' <span class="ico flaticon-amplifier"></span>';break;case"3":t+=' <span class="ico flaticon-important"></span>';break;default:t+=' <span class="ico flaticon-normal"></span>'}y.length>0&&(t+="<small>at "+y+"</small>"),t+='</div></div><p class="post emojis-wysiwyg">'+u+"</p>";for(var v=e.feeds[o].attachments,k=[],w=[],I=0;I<v.length;I++)if(0==v[I].is_deleted){var j=v[I].type;"image"==j?k.push(v[I]):w.push(v[I])}if(k.length>0){t+='<div id="links" class="feed-content-post-img"><section class="Collage effect-parent">';for(var E=3,B=0;B<k.length;B++){var T=k[B].preview,x=k[B].download_url,M=k[B].filename;E>B&&(t+='<div class="media-body">',t+='<a href="'+x+'" class="swipebox" title="'+M+'">',t+='<img class="img-responsive" src="data:image/gif;base64,'+T+'" width:100% alt="'+M+'"  >',t+="</a>",t+="</div>");var L=E-1;B==L&&(t+="</section>")}t+="</div>"}if(w.length>0){t+='<div class="feed-content-post-attachment"><i>Attachments</i><ul>';for(var H=0;H<w.length;H++){var M=w[H].filename,$=w[H].size,S=(w[H].id,w[H].download_url);t+='<li><a href="'+S+'"  target="_blank">'+M+"</a> - "+$+" </li>"}t+="</ul></div>"}a=1==_?"btn-agree-active":"",t+='<ul class="half-2 clearfix"><li><button id="btn_post_ag_'+s+'" type="button" class="btn btn-default btn-block '+a+'" onclick="postagree('+s+');"><i class="flaticon-check-circle"></i> Agree (<span id ="agree_count_'+s+'">'+g+'</span>)</button></li><li><button type="button" class="btn btn-default btn-block" ontouchstart="viewpostcomment('+s+","+n+');" data-toggle="modal" href="#comments"><i class="flaticon-comment-more"></i> Comments ('+f+")</button></li></ul></div></div>"}},error:function(e){document.getElementById("feednotif").style.display="block",window.setTimeout("hideMessagefeed()",4e3),console.log(e.message)}}).done(function(){t.length>0&&(window.localStorage.latestnewsfeed=t,window.localStorage.nextpagedate=nextpagedate,document.getElementById("streamlist").innerHTML=window.localStorage.getItem("latestnewsfeed"),call_emoticons("streamlist"))}):(document.getElementById("feednotif").style.display="block",window.setTimeout("hideMessagefeed()",4e3)),delete getnewsfeed}function nextnewsfeed(){var e="";checkConnection()>2?$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/newsfeed",data:{sid:ses_id,mypost:0,startdate:nextpagedate,itemperpage:2},beforeSend:function(){preloading2()},success:function(t){if(nextpagedate=t.nextpage_date,t.items>0)for(var o=0;o<t.items;o++){var a,s=t.feeds[o].id,n=t.feeds[o].poster_id,i=t.feeds[o].poster_name,l=t.feeds[o].date_posted,c=t.feeds[o].post_mood,d=t.feeds[o].project_id,r=t.feeds[o].task_id,m=t.feeds[o].to_user_id,p=t.feeds[o].title,u=t.feeds[o].content,g=t.feeds[o].agree_count,f=t.feeds[o].comment_count,y=t.feeds[o].location,_=t.feeds[o].is_agree,h="";if(getposterpic(n),d>0&&(h=' posted in <a ontouchstart="projectinfo('+d+');"  >'+p+"</a>"),m>0&&m!=localStorage.getItem("ts_myid")){getnfeeduserinfo(m);var b=getnfeeduname;h='<i class="flaticon-arrow-right"></i> <a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+m+');" >'+b+"</a>"}switch(r>0&&(h=' posted on task <a data-toggle="modal" href="#taskinfo" ontouchstart="getmytaskinfo('+d+","+r+');" >'+gettaskname(d,r)+"</a>"),e+='<div class="inner-wrapper" id ="newsfeed-'+s+'"><div class="main-user-post"><div class="media"><a class="pull-left" data-toggle="modal" href="#userprof"  ontouchstart="userprofile('+n+');"  ><img class="media-object img-circle" src="data:image/gif;base64,'+getnfeedprofpic+'" width="50" height="50" alt="Image"></a><div class="media-body">',n==localStorage.getItem("ts_myid")&&(e+='<div class="btn-group pull-right" ><span class="ico flaticon-arrow-bottom dropdown-toggle" data-toggle="modal" href="#postsettings" ontouchstart="postsettings('+s+')"></span></div>'),e+='<h4 class="media-heading"><a data-toggle="modal" href="#userprof"  ontouchstart="userprofile('+n+');" >'+i+"</a>"+h+" </h4><small>"+l+"</small>",c){case"1":e+=' <span class="ico flaticon-lamp"></span>';break;case"2":e+=' <span class="ico flaticon-amplifier"></span>';break;case"3":e+=' <span class="ico flaticon-important"></span>';break;default:e+=' <span class="ico flaticon-normal"></span>'}y.length>0&&(e+="<small>at "+y+"</small>"),e+='</div></div><p class="post emojis-wysiwyg">'+u+"</p>";for(var v=t.feeds[o].attachments,k=[],w=[],I=0;I<v.length;I++)if(0==v[I].is_deleted){var j=v[I].type;"image"==j?k.push(v[I]):w.push(v[I])}if(k.length>0){e+='<div id="links" class="feed-content-post-img"><section class="Collage effect-parent">';for(var E=3,B=0;B<k.length;B++){var T=k[B].preview,x=k[B].download_url,M=k[B].filename;E>B&&(e+='<div class="media-body">',e+='<a href="'+x+'" class="swipebox" title="'+M+'">',e+='<img class="img-responsive" src="data:image/gif;base64,'+T+'" width:100% alt="'+M+'"  >',e+="</a>",e+="</div>");var L=E-1;B==L&&(e+="</section>")}e+="</div>"}if(w.length>0){e+='<div class="feed-content-post-attachment"><i>Attachments</i><ul>';for(var H=0;H<w.length;H++){var $=w[H].size,S=w[H].download_url;e+='<li><a href="'+S+'"  target="_blank">'+M+"</a> - "+$+" </li>"}e+="</ul></div>"}a=1==_?"btn-agree-active":"",e+='<ul class="half-2 clearfix"><li><button id="btn_post_ag_'+s+'" type="button" class="btn btn-default btn-block '+a+'" onclick="postagree('+s+');"><i class="flaticon-check-circle"></i> Agree (<span id ="agree_count_'+s+'">'+g+'</span>)</button></li><li><button type="button" class="btn btn-default btn-block" ontouchstart="viewpostcomment('+s+","+n+');" data-toggle="modal" href="#comments"><i class="flaticon-comment-more"></i> Comments ('+f+")</button></li></ul></div></div>"}},error:function(e){document.getElementById("feednotif").style.display="block",window.setTimeout("hideMessagefeed()",4e3),console.log(e.message)}}).done(function(){if(e.length>0){var t=document.createElement("div");t.innerHTML=e,document.getElementById("streamlist").appendChild(t),call_emoticons("streamlist")}}):(document.getElementById("feednotif").style.display="block",window.setTimeout("hideMessagefeed()",4e3))}function gettaskname(e,t){var o;return $.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/tasklist/"+e,data:{sid:ses_id},success:function(e){if(1==e.status)for(var a=0;a<e.items.length;a++)t==e.items[a].id&&(o=e.items[a].task_title)},error:function(e){console.log(e.message)}}),o}function commentonwrite(){var e=document.getElementById("inptcomment").value;document.getElementById("bttndocomment").disabled=e.length<1?!0:!1}function viewpostcomment(e,t){cur_postid=e,cur_posterid=t;var o="";document.getElementById("commentlist").innerHTML="",document.getElementById("commentlist").style.display="none",$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/comment/get/"+e,data:{sid:ses_id},beforeSend:function(){document.getElementById("commentlist").innerHTML="",preloading3()},success:function(e){for(var a=e.length-1;a>=0;a--){var s=e[a].id,n=e[a].commentor,i=e[a].message,l=e[a].date_commented,c=e[a].commentor_id,d="",r="";t==localStorage.getItem("ts_myid")&&(d='<button type="button" class="close" ontouchstart="conf_delete_comment('+s+')">Ã—</button>'),n==window.localStorage.getItem("name")&&(r='<button type="button" class="close" style="font-size: 16px;" ontouchstart="comment_edit('+s+')" >Edit</button>'),o+='<div class="media" id="comment-'+s+'"><a class="pull-left" a ><img class="media-object img-circle" src="'+showprofpic(c)+'" width="35" alt="Image"></a><div id="delete-button-'+s+'">'+d+'</div><div class="media-body"><h4 class="media-heading"><a  >'+n+"</a> <small>"+l+'</small></h4><p class="post" id="comment-content-'+s+'">'+i+'</p><div id="edit-comment-'+s+'"></div><div id="edit-cancel-button-'+s+'">'+r+"</div></div></div>"}},error:function(e){document.getElementById("commentlist").style.display="none",console.log(e.message)}}).done(function(){o.length>0?(document.getElementById("commentlist").style.display="block",document.getElementById("commentlist").innerHTML=o,call_emoticons("commentlist")):document.getElementById("commentlist").style.display="none",stoppreload()}).fail(function(e){console.log(e.message),stopload(),navigator.notification.alert("Network Connection Error Kindly Check your Internet Connection",alertDismissed,"TeamStorm App","Ok")})}function showprofpic(e){var t="img/user/thumb-user-medium.jpg";return $.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user",data:{sid:ses_id,id:e},success:function(e){t=e.profile_pic},error:function(e){console.log(e.message)}}),t}function comment_edit(e){document.getElementById("edit-comment-"+e).innerHTML='<div class="input-group"><textarea rows=1 class="form-control" id="inpteditcomment-'+e+'" onkeyup="textAreaAdjust(this)" style="overflow:hidden"></textarea> <div class="input-group-btn"><button type="button" class="btn" tabindex="-1" ontouchstart="do_editcomment('+e+');" style="background: transparent;color: #00BDFF;"><i class="flaticon-check"></i></button></div></div>',document.getElementById("inpteditcomment-"+e).value=document.getElementById("comment-content-"+e).innerHTML,document.getElementById("edit-cancel-button-"+e).innerHTML='<button type="button" class="close" style="font-size: 16px;" ontouchstart="cancelcomment_edit('+e+')" >Cancel</button>',document.getElementById("comment-content-"+e).style.display="none",document.getElementById("delete-button-"+e).innerHTML=""}function cancelcomment_edit(e){document.getElementById("edit-comment-"+e).innerHTML="",document.getElementById("edit-cancel-button-"+e).innerHTML='<button type="button" class="close" style="font-size: 16px;" ontouchstart="comment_edit('+e+')" >Edit</button>',document.getElementById("comment-content-"+e).style.display="block",document.getElementById("delete-button-"+e).innerHTML='<button type="button" class="close" ontouchstart="conf_delete_comment('+e+')">Ã—</button>'}function do_editcomment(e){var t=document.getElementById("inpteditcomment-"+e).value;$.ajax({type:"post",async:!1,dataType:"json",url:"http://teamstormapps.host/mobile/comment/update",data:{sid:ses_id,id:e,comment:t},beforeSend:function(){preloading2()},success:function(o){o.id==e&&(document.getElementById("edit-comment-"+e).innerHTML="",document.getElementById("edit-cancel-button-"+e).innerHTML='<button type="button" class="close" style="font-size: 16px;" ontouchstart="comment_edit('+e+')" >Edit</button>',document.getElementById("comment-content-"+e).innerHTML=t,document.getElementById("comment-content-"+e).style.display="block",document.getElementById("delete-button-"+e).innerHTML='<button type="button" class="close" ontouchstart="comment_delete('+e+')">Ã—</button>')},error:function(e){console.log(e.message)}})}function conf_delete_comment(e){cur_commentid=e,navigator.notification.confirm("Do you want to remove this comment?",delete_comment,"Confirmation Message",["Ok","Cancel"])}function delete_comment(e){1==e&&$.ajax({type:"post",async:!0,dataType:"json",url:"http://teamstormapps.host/mobile/comment/delete/"+cur_commentid,data:{sid:ses_id},beforeSend:function(){preloading2()},success:function(e){if(1==e.status){var t=document.getElementById("commentlist"),o=document.getElementById("comment-"+cur_commentid);t.removeChild(o)}},error:function(e){console.log(e.message)}})}function do_comment(){var e=document.getElementById("inptcomment").value;$.ajax({type:"post",async:!0,dataType:"json",url:"http://teamstormapps.host/mobile/comment/new",data:{sid:ses_id,post_id:cur_postid,comment:e},beforeSend:function(){preloading2()},success:function(e){1==e.status&&(viewpostcomment(cur_postid,cur_posterid),document.getElementById("inptcomment").value="",getnewsfeed(!0))},error:function(e){console.log(e.message)}}),delete do_comment}function postsettings(e){cur_set_postid=e}function conf_delete_post(){navigator.notification.confirm("Are you sure you want to remove this post?",delete_post,"Confirmation Message",["Ok","Cancel"])}function delete_post(e){1==e&&$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/post/delete/"+cur_set_postid,data:{sid:ses_id},beforeSend:function(){preloading2()},success:function(e){1==e.status&&removepost()},error:function(e){console.log(e.message)}})}function removepost(){var e=document.getElementById("streamlist"),t=document.getElementById("newsfeed-"+cur_set_postid);e.removeChild(t)}function postagree(e){$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/post/agree/"+e,data:{sid:ses_id},beforeSend:function(){preloading2()},success:function(t){if(1==t.status){var o=document.getElementById("btn_post_ag_"+e);if(1==t.is_agree){var a=document.getElementById("agree_count_"+e),s=a.textContent;o.classList.add("btn-agree-active"),document.getElementById("agree_count_"+e).innerHTML=parseInt(s)+1}else{var n=document.getElementById("agree_count_"+e),i=n.textContent;o.classList.remove("btn-agree-active"),document.getElementById("agree_count_"+e).innerHTML=parseInt(i)-1}}},error:function(e){console.log(e.message)}})}function call_emoticons(e){emojify.setConfig({emojify_tag_type:"i",only_crawl_id:e,img_dir:"emojify/images/emoji",ignore_emoticons:!1,ignored_tags:{SCRIPT:1,TEXTAREA:1,A:1,PRE:1,CODE:1}}),emojify.run()}function encodeImage(e,t){var o=document.createElement("canvas"),a=o.getContext("2d"),s=new Image;s.setAttribute("crossOrigin","anonymous"),s.onload=function(){o.width=s.width,o.height=s.height,a.drawImage(s,0,0,s.width,s.height),t(o.toDataURL())},s.src=e}function getnfeeduserinfo(e){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user",data:{sid:ses_id,id:e},success:function(e){getnfeeduname=e.name},error:function(e){console.log(e.message)}})}function getposterpic(e){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user",data:{sid:ses_id,id:e},success:function(e){getnfeedprofpic=e.preview_pic},error:function(e){console.log(e.message)}})}function getmyprofile(){checkConnection()>2&&$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user",data:{sid:ses_id},success:function(e){window.localStorage.ts_myid=e.id,window.localStorage.ts_myusrlvl=e.userlevel,window.localStorage.name=e.name,window.localStorage.ts_myemail=e.email,window.localStorage.ts_myfname=e.firstname,window.localStorage.ts_mymname=e.middlename,window.localStorage.ts_mylname=e.lastname,window.localStorage.ts_mygender=e.gender,window.localStorage.ts_myprofpic=e.preview_pic,window.localStorage.ts_mycompany=e.company,window.localStorage.ts_mylocation=e.location,window.localStorage.ts_mycontact=e.contact,window.localStorage.ts_mylast_school=e.last_school},error:function(e){console.log(e.message)}})}function getaddressbook(){var e="";$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/addressbook",data:{sid:ses_id},success:function(t){e+='<table class="table table-responsive" > <tbody >';for(var o=0;o<t.length;o++){var a=t[o].user_id,s=t[o].fullname,n=t[o].email,i=t[o].preview_pic;e+='<tr id="'+a+'"><td><div class="checkbox" style="left:23px;"><div class="chk"><input type="checkbox" value="'+n+'" id="chk_contacts_'+a+'" name="Contacts" class="icheckbox_flat"></div></div></td><td><div class="portrait-status chat" style="left:20px;"><img src="data:image/gif;base64,'+i+'" height="35" height="35" class="img-circle" data-toggle="modal" href="#userprof" ontouchstart="userprofile('+a+');"> </td></div><td><a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+a+');">'+s+"</a></td></td></tr>"}e+="</tbody ><table>",e.length>0&&(window.localStorage.latestcontacts=e)},error:function(e){console.log(e.message)}}),getaddressbookperletter()}function getaddressbookperletter(){var e="";$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/addressbook",data:{sid:ses_id},success:function(t){for(var o=0;o<t.length;o++){var a=t[o].fullname,s=t[o].user_id,n=t[o].email,i=t[o].preview_pic;e='<tr id="'+s+'"><td><div class="checkbox" style="left:23px;"><div class="chk"><input type="checkbox" value="'+n+'" id="chk_contactslet_'+s+'" name="Contacts" class="icheckbox_flat"></div></div></td><td><div class="portrait-status chat" style="left:20px;"><img src="data:image/gif;base64,'+i+'" height="35" height="35" class="img-circle" data-toggle="modal" href="#userprof" ontouchstart="userprofile('+s+');"> </td></div><td><a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+s+');">'+a+"</a></td></td></tr>";var l=document.createElement("tr");l.innerHTML=e,document.getElementById("address_"+a.charAt(0).toUpperCase()).appendChild(l)}},error:function(e){console.log(e.message)}})}function conf_signout(){navigator.notification.confirm("Are you sure want to log out?",signout,"TeamStormApps",["Log Out","Cancel"])}function signout(e){1==e&&(window.location.replace("login.html"),$.ajax({type:"post",global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/auth/logout",data:{sid:ses_id},success:function(e){0==e.status||1==e.status},error:function(e,t,o){console.log(o.description)}}))}function callchat(){preloading(),window.location.replace("chat.html")}function getprojectsinvite(){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/getlist",data:{sid:ses_id},success:function(e){if(e.length>0){for(var t="",o=0;o<e.length;o++){var a=e[o];t+="<li>",t+='<a  data-toggle="modal" href="#inviteprojectlist" ontouchstart="inviteproject_select('+a.id+');">',t+='<div class="dv-notif "  id="invite_prjlist-'+a.id+'">',t+='<div class="dv-info un-read">',t+='<span class="name" > '+a.project_title+"</span>",t+="</div>",t+="</div>",t+="</a>",t+="</li>"}e.length>0&&$("#invite_prjlist_holder").html(t)}}})}function inviteproject_select(e){for(var t=getCheckedBoxes("Contacts"),o="",a=0;a<t.length;a++)o+=t[a].value+",";o=o.slice(0,-1),$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/addmembers_post/"+e,data:{sid:ses_id,emails:o},success:function(e){1==e.status&&(navigator.notification.alert("New Members added!",alertDismissed,"Invite Members","Ok"),loadaddress()),alert(e.status)},error:function(e){console.log(e.message)}})}function load_memo(){document.getElementById("txt_memopad").focus(),preloading2();var e="";$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/memopad",data:{sid:ses_id},success:function(t){if(t.length>0)for(var o=0;o<t.length;o++){var a=t[o].id,s=t[o].content,n=(t[o].date_created,t[o].last_update,s.split("\n"));e+='<div class="panel" id="memo-'+a+'"><button type="button" class="close"   ontouchstart="conf_delete_memo('+a+');">Ã—</button><div class="panel-heading"><h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion1" href="#note-'+a+'">'+n[0]+'</a></h4></div><div id="note-'+a+'" class="panel-collapse collapse"><div class="panel-body">'+s+"</div></div></div>"}},error:function(e){console.log(e.message)}}),document.getElementById("memolist").innerHTML=e}function addnote(){var e;e='<div class="panel" id="memo-0"><button type="button" class="close" data-dismiss="alert" aria-hidden="true" ontouchstart="clearnote();">Ã—</button><div class="panel-heading"><h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion1" href="#note-0" id="tempmemo">Untitled</a></h4></div><div id="note-0" class="panel-collapse collapse"><div class="panel-body" id="tempnote">(No Content)</div></div></div>';var t=document.getElementById("memolist"),o=document.createElement("div");o.innerHTML=e,t.insertBefore(o,t.childNodes[0]),document.getElementById("btn_addnote").disabled=!0}function memoonwrite(){var e=document.getElementById("txt_memopad").value,t=e.split("\n");e.length<1?(document.getElementById("tempmemo").innerHTML="Untitled",document.getElementById("tempnote").innerHTML="(No Content)",document.getElementById("btn_savememo").disabled=!0):(document.getElementById("tempmemo").innerHTML=t[0],document.getElementById("tempnote").innerHTML=e,document.getElementById("btn_savememo").disabled=!1)}function clearnote(){document.getElementById("txt_memopad").value="",document.getElementById("btn_addnote").disabled=!1}function do_memo(){var e=document.getElementById("txt_memopad").value;$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/memopad/create",data:{sid:ses_id,content:e},success:function(e){1==e.status&&(document.getElementById("txt_memopad").value="",load_memo(),document.getElementById("btn_addnote").disabled=!1)},error:function(e){console.log(e.message)}})}function conf_delete_memo(e){curmemoid=e,navigator.notification.confirm("Are you sure you want to delete this note?",delete_memo,"Confirmation Message",["Ok","Cancel"])}function delete_memo(e){1==e&&$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/memopad/delete/"+curmemoid,data:{sid:ses_id},success:function(e){1==e.status&&load_memo()},error:function(e){console.log(e.message)}})}function load_myprofile(){getmyprofile(),document.getElementById("my_profname").innerHTML=window.localStorage.getItem("name"),document.getElementById("my_profpic").src="data:image/gif;base64,"+window.localStorage.getItem("ts_myprofpic"),document.getElementById("txt_myproffirstname").value=window.localStorage.getItem("ts_myfname"),document.getElementById("txt_myprofmiddlename").value=window.localStorage.getItem("ts_mymname"),document.getElementById("txt_myproflastname").value=window.localStorage.getItem("ts_mylname"),document.getElementById("slct_myprofgender").value=window.localStorage.getItem("ts_mygender"),document.getElementById("txt_myprofaddress").value=window.localStorage.getItem("ts_mylocation"),document.getElementById("txt_myprofcompany").value=window.localStorage.getItem("ts_mycompany"),document.getElementById("txt_myprofschoolgrad").value=window.localStorage.getItem("ts_mylast_school"),document.getElementById("txt_myprofcontact").value=window.localStorage.getItem("ts_mycontact"),document.getElementById("txt_myprofemail").value=window.localStorage.getItem("ts_myemail")}function back_stream(){window.history.back()}function hideMessage(){document.getElementById("allert_error").style.display="none",document.getElementById("allert_success").style.display="none"}function updatemyprofile(){var e=window.localStorage.getItem("session_id");checkConnection()>2?$.ajax({type:"post",async:!1,global:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user/update_info",data:{sid:e,firstname:document.getElementById("txt_myproffirstname").value,lastname:document.getElementById("txt_myproflastname").value,middlename:document.getElementById("txt_myprofmiddlename").value,email:document.getElementById("txt_myprofemail").value,gender:document.getElementById("slct_myprofgender").value,company:document.getElementById("txt_myprofcompany").value,location:document.getElementById("txt_myprofaddress").value,lastschool:document.getElementById("txt_myprofschoolgrad").value,contact:document.getElementById("txt_myprofcontact").value},beforeSend:function(){preloading2()},success:function(e){0==e.status?(alert(e.message),document.getElementById("sup_statmessage").innerHTML=e.message,document.getElementById("allert_error").style.display="block",window.setTimeout("hideMessage()",2500)):1==e.status&&(changepassword(),1==passwordok&&(document.getElementById("suc_message").innerHTML=e.message,document.getElementById("allert_success").style.display="block",window.setTimeout("hideMessage()",4500)))},error:function(e){alert(e.message)}}):navigator.notification.alert("Network Connection Error Kindly Check your Internet Connection",alertDismissed,"TeamStorm App","Ok")}function changepassword(){var e=window.localStorage.getItem("session_id"),t=document.getElementById("txt_myprofnewpass1").value,o=document.getElementById("txt_myprofnewpass2").value;t.length>=6&&(t===o?$.ajax({type:"post",async:!1,global:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user/update_pass",data:{sid:e,old_password:document.getElementById("txt_myprofoldpass").value,new_password:t},success:function(e){0==e.status?(document.getElementById("sup_statmessage").innerHTML=e.message,document.getElementById("allert_error").style.display="block",window.setTimeout("hideMessage()",4500),passwordok=0):1==e.status&&(clearmyprofpass(),document.getElementById("suc_message").innerHTML=e.message,document.getElementById("allert_success").style.display="block",window.setTimeout("hideMessage()",4500),passwordok=1)},error:function(){}}):(document.getElementById("sup_statmessage").innerHTML="Password not Match",document.getElementById("allert_error").style.display="block",window.setTimeout("hideMessage()",4500)))}function clearmyprofpass(){document.getElementById("txt_myprofoldpass").value="",document.getElementById("txt_myprofnewpass1").value="",document.getElementById("txt_myprofnewpass2").value=""}function back_stream(){window.history.back()}function getmultiimage(){}function postonwrite(e){var t=document.getElementById("txt_post").value;document.getElementById("bttndopost").disabled=t.length<1?!0:!1,e.style.height="1px",e.style.height=25+e.scrollHeight+"px"}function newpost(){writejsonfile(),clearposttext(),loadprojects_select(),document.getElementById("divselectproject").style.display="block",document.getElementById("searchpostuser").style.display="table-row",postmember_search()}function clearposttext(){document.getElementById("select_projlists").value="",document.getElementById("tasknamepost").innerHTML="",document.getElementById("txtposttoid").value=""}function loadprojects_select(){var e='<option value="0">Project list</option>';$.ajax({type:"post",dataType:"json",url:"http://teamstormapps.host/mobile/project/getlist",data:{sid:ses_id},success:function(t){for(var o=0;o<t.length;o++)e+='<option value="'+t[o].id+'">'+t[o].project_title+"</option>";window.localStorage.projlist=e},error:function(e){console.log(e.message)}}),document.getElementById("select_projlists").innerHTML=window.localStorage.getItem("projlist")}function do_post(){var e=window.localStorage.getItem("cur_loc"),t=0,o=document.getElementById("chk_txt_post").checked,a=document.getElementById("txt_post").value,s=document.getElementById("select_projlists"),n=0,i=0,l=0;document.getElementById("option1").checked&&(t=document.getElementById("option1").value),document.getElementById("option2").checked&&(t=document.getElementById("option2").value),document.getElementById("option3").checked&&(t=document.getElementById("option3").value),document.getElementById("option4").checked&&(t=document.getElementById("option4").value),i=document.getElementById("txtposttotaskid").value,n=document.getElementById("txtposttoid").value,i>0?l=document.getElementById("txtposttotaskprjid").value:0==i&&(l=s.options[s.selectedIndex].value),a.trim().length>0?checkConnection()>2?$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/post/dopost",data:{sid:ses_id,post_type:t,message:a,sendtomail:o,project_id:l,to_uid:n,task_id:i,location:e},beforeSend:function(){preloading2()},success:function(e){1==e.status&&(getnewsfeed(!1),clearpost(),clearimg_count())},error:function(e){console.log(e.message)}}):navigator.notification.alert("Network Connection Error Kindly Check your Internet Connection",alertDismissed,"TeamStorm App","Ok"):navigator.notification.alert("Please type message before posting",alertDismissed,"TeamStorm Post","Ok")}function alertDismissed(){}function clearpost(){document.getElementById("option1").checked=!0,document.getElementById("chk_txt_post").checked=!1,document.getElementById("txt_post").value="",document.getElementById("select_projlists").value=0,document.getElementById("txtposttoid").value=0,document.getElementById("search-contacts").value="",document.getElementById("txtposttotaskprjid").value=0,document.getElementById("txtposttotaskid").value=0,document.getElementById("txtposttoid").value=0,document.getElementById("search-contacts").value=""}function uploadfile(e){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/upload",data:{sid:ses_id,files:e},success:function(e){alert(e.files[0].url)},error:function(e){alert(e.message),console.log(e.message)}})}function upwin(e){console.log("Code = "+e.responseCode),console.log("Response = "+e.response),console.log("Sent = "+e.bytesSent);{var t=e.response.substr(e.response.lastIndexOf("id=")+3);t.split('"')}stopload()}function deleteuploadimage(e){$.get("http://teamstormapps.host/upload/remove_temp?id="+e,function(e){1==e.success&&console.log("Image deleted")})}function upfail(e){stopload(),console.log("upload error source "+e.source),console.log("upload error target "+e.target)}function postmember_search(){$(".txt-search-member").keyup(function(){$(".mem-list .mem-list-content .mem-list-info-name ").each(function(){$(this).text().toLowerCase().search($(".txt-search-member").val().toLowerCase())>-1?$(this).parent().parent().fadeIn(200):$(this).parent().parent().fadeOut(200)})});var e="http://teamstormapps.host/";$("#search-contacts").autocomplete({source:e+"search/member",selectFirst:!0,autoFocus:!0,search:function(){$(".btn-proj-add-member > span").removeClass("fa-search").addClass("fa-spinner fa-spin"),$(".btn-proj-add-member > span").click(function(){return!1})},response:function(e,t){$(".btn-proj-add-member > span").addClass("fa-plus").removeClass("fa-spinner fa-spin"),$(".no-result").text(t.content.length?"":"No match found.")
},select:function(e,t){return $("#search-contacts").val(t.item.fullname),document.getElementById("txtposttoid").value=t.item.id,$(".btn-proj-add-member > span").removeClass("fa-search").removeClass("fa-spinner fa-spin").addClass("fa-plus"),$(".btn-proj-add-member > span").click(function(){return!0}),!1}}).focus(function(){$(this).autocomplete("search",this.value)}).data("ui-autocomplete")._renderItem=function(t,o){var a='<a href="javascript:void(0);"><img src="'+e+"thumbs/profile?id="+o.id+"&hash="+o.image+'" width="45" height="45" class="img-circle" />  <td>'+o.fullname+"</a></td>";return $("<li></li>").data("item.autocomplete",o).append(a).appendTo(t)},$("#search-contacts").keypress(function(e){13==e.which&&$(".btn-info.prj_btn_add").click()})}function load_todo(){preloading2();var e="",t="",o="",a="";$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/todo",data:{sid:ses_id},success:function(s){if(s.length>0)for(var n=0;n<s.length;n++){var i,l,c,d=s[n].id,r=s[n].status,m=s[n].priority,p=s[n].title,u=(s[n].description,s[n].target_date),g=s[n].create_date;i=u.split("/"),l=g.split("/"),months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var f;switch(f="n/a"==u?months[l[0]-1]+" "+l[1]+", "+l[2]:months[i[0]-1]+" "+i[1]+", "+i[2],e='<div class="panel" id="todo-'+d+'"><button type="button" class="close"   ontouchstart="conf_delete_todo('+d+')">Ã—</button><div class="panel-heading"><h4 class="panel-title"><a >'+p+"</a>",m){case"1":e+='<label style=" color:white; background:#aeafb1">Low</label>';break;case"2":e+='<label style=" color:white; background:#2bbce0">Normal</label>';break;case"3":e+='<label style=" color:white; background:#e73c3c">High</label>'}e+="<p>"+f+"</p></h4></div></div>","n/a"!==u?curdate>c?a+=e:"active"==r?t+=e:"completed"==r&&(o+=e):"n/a"==u&&(t+=e)}},error:function(e){console.log(e.message)}}),document.getElementById("activetodolist").innerHTML=t,document.getElementById("completedtodolist").innerHTML=o,document.getElementById("overduetodolist").innerHTML=a}function do_todo(){var e=document.getElementById("txt_todotitle").value,t=document.getElementById("txt_tododate").value,o=document.getElementById("select_todopriority").value,a=document.getElementById("txt_tododesc").value;$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/todo/create",data:{sid:ses_id,title:e,description:a,priority:o,duedate:t},success:function(e){1==e.status&&(document.getElementById("txt_todotitle").value="",document.getElementById("txt_tododate").value="",document.getElementById("select_todopriority").value=1,document.getElementById("txt_tododesc").value="")},error:function(e){console.log(e.message)}})}function conf_delete_todo(e){cur_todoid=e,navigator.notification.confirm("Delete this note?",delete_todo,"Confirmation Message",["Ok","Cancel"])}function delete_todo(e){1==e&&$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/todo/delete/"+cur_todoid,data:{sid:ses_id},success:function(e){1==e.status&&load_todo()},error:function(e){console.log(e.message)}})}function back_stream(){window.history.back()}function userprofile(e){cur_uid=0==e?localStorage.getItem("ts_myid"):e;var t,o,a,s,n,i,l,c,d,r,m,p,u,g,f,y,_,h,b;if(checkConnection()>2){if($.ajax({type:"post",async:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user",data:{sid:ses_id,id:cur_uid},beforeSend:function(){preloading2()},success:function(e){t=e.id,o=e.userlevel,a=e.email,s=e.name,n=e.firstname,i=e.lastname,l=e.gender,c=e.preview_pic,d=e.company,r=e.location,m=e.contact,p=e.last_school,u=e.timezone,g=e.date_joined,f=e.followers,y=e.following,_=e.projects,h=e.tasks,b=e.is_following},error:function(e){console.log(e.message),navigator.notification.alert("Network Connection Error Kindly Check your Internet Connection",alertDismissed,"TeamStorm App","Ok"),document.getElementById("usernamehdr").innerHTML="",document.getElementById("userprof_pic").src="img/user/thumb-user-medium.jpg",document.getElementById("userprof_name").innerHTML="",document.getElementById("btn_follow_unfollow").style.display="none",document.getElementById("userprof_id").innerHTML="",document.getElementById("userprof_fullname").innerHTML="",document.getElementById("userprof_gender").innerHTML="",document.getElementById("userprof_address").innerHTML="",document.getElementById("userprof_company").innerHTML="",document.getElementById("userprof_school").innerHTML="",document.getElementById("userprof_mobile").innerHTML="",document.getElementById("userprof_emailadd").innerHTML=""}}),document.getElementById("usernamehdr").innerHTML=s,document.getElementById("userprof_pic").src="data:image/gif;base64,"+c,document.getElementById("userprof_name").innerHTML=s,cur_is_following=b,cur_uid!=localStorage.getItem("ts_myid")?document.getElementById("btn_follow_unfollow").style.display="block":cur_uid==localStorage.getItem("ts_myid")&&(document.getElementById("btn_follow_unfollow").style.display="none"),1==b){document.getElementById("btn_follow_unfollow").innerHTML='<i class="flaticon-check" style="color: #FFF;"  >  Following</i> '}else if(0==b){document.getElementById("btn_follow_unfollow").innerHTML='<i class="flaticon-adduser" > Follow</i> '}document.getElementById("userprof_id").innerHTML=t,document.getElementById("userprof_fullname").innerHTML=s,0==l?document.getElementById("userprof_gender").innerHTML="Male":1==l&&(document.getElementById("userprof_gender").innerHTML="Female"),document.getElementById("userprof_address").innerHTML=r,document.getElementById("userprof_company").innerHTML=d,document.getElementById("userprof_school").innerHTML=p,document.getElementById("userprof_mobile").innerHTML=m,document.getElementById("userprof_emailadd").innerHTML=a}else navigator.notification.alert("Network Connection Error Kindly Check your Internet Connection",alertDismissed,"TeamStorm App","Ok"),document.getElementById("usernamehdr").innerHTML="",document.getElementById("userprof_pic").src="img/user/thumb-user-medium.jpg",document.getElementById("userprof_name").innerHTML="",document.getElementById("btn_follow_unfollow").style.display="none",document.getElementById("userprof_id").innerHTML="",document.getElementById("userprof_fullname").innerHTML="",document.getElementById("userprof_gender").innerHTML="",document.getElementById("userprof_address").innerHTML="",document.getElementById("userprof_company").innerHTML="",document.getElementById("userprof_school").innerHTML="",document.getElementById("userprof_mobile").innerHTML="",document.getElementById("userprof_emailadd").innerHTML=""}function follow_unfollow(){0==cur_is_following?do_follow():1==cur_is_following&&conf_unfollow()}function conf_unfollow(){navigator.notification.confirm("Do you want to Unfollow this person?",do_unfollow,"Confirmation Message",["Ok","Cancel"])}function do_follow(){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user/follow/"+cur_uid,data:{sid:ses_id},success:function(e){1==e.status&&(document.getElementById("btn_follow_unfollow").innerHTML='<i class="flaticon-check" style="color: #FFF;" >  Following</i> ',cur_is_following=1)},error:function(e){console.log(e.message)}})}function do_unfollow(e){1==e&&$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user/unfollow/"+cur_uid,data:{sid:ses_id},success:function(e){1==e.status&&(document.getElementById("btn_follow_unfollow").innerHTML='<i class="flaticon-adduser" > Follow</i> ',cur_is_following=0)},error:function(e){console.log(e.message)}})}function notification_refresh(){var e=0,t=0,o=0,a="";$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/notification",data:{sid:ses_id},success:function(e){first_notif_id=e[0].id;for(var t=0;t<e.length;t++){var o=e[t],s=0==o.is_read?!0:!1,n=o.profile_pic,i=o.description.replace(o.fullname,"");a+="<li>",a+='<a  data-toggle="modal" href="#notification" ontouchstart="notif_click('+o.id+');">',a+='<div class="dv-notif '+(s?"un-read":"")+'"  id="notif-info-'+o.id+'">',a+='<img src="data:image/gif;base64,'+n+'" class="img-circle" width="60" height="60"  alt="Image" />',a+='<div class="dv-info">',a+='<span class="name">'+o.fullname+"</span><span> "+i+"</span>",a+='<span class="n-time"><span class="fa fa-clock-o"></span> '+o.date_notified+"</span>",a+="</div>",a+="</div>",a+="</a>",a+="</li>"}}}).done(function(){$("#notif_gen_holder").html(a)}),getprojectnotiflist(),gettasknotiflist(),$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/notification/notif_count",data:{sid:ses_id},success:function(t){t.count>0&&($("#notif_gen_count").html(t.count),e=t.count,cur_notifcount=t.count,t.count>cur_notifcount2&&(navigator.notification.vibrate(2e3),cur_notifcount2=t.count,pushnotification()))},error:function(e){console.log(e.message)}});var s=parseInt(e)+parseInt(t)+parseInt(o);$("#notif_all_count").html(s>0?s:""),delete notification_refresh}function getprojectnotiflist(){var e="";$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/notification/projects",data:{sid:ses_id},success:function(t){if(t.length>0){tasknotif=t.length,document.getElementById("notif_prj_count").innerHTML=t.length;for(var o=0;o<t.length;o++){var a=t[o].profile_picture,s=t[o].content.replace(t[o].actor_name,"");e+='<li id="notif_prj_'+t[o].project_id+'">',e+='<div class="dv-notif new">',e+='<img src="data:image/gif;base64,'+a+'" class="img-circle" width="60" height="60"  alt="Image" />',e+='<div class="dv-info">',e+='<span class="name">'+t[o].actor_name+"</span>",e+='<span class="msg">'+s+"</span>",e+="<span><a ></a></span>",e+='<span class="n-time">'+t[o].timestamp+"</span>",e+='<div class="pull-right options btn-group">',e+='<button class="btn btn-success btn-xs tooltips" data-placement="top" data-title="Accept" ontouchstart="n_project_accept('+t[o].project_id+')" style="width:50px;"><span class="flaticon-check"></span></button>',e+='<button class="btn btn-default btn-xs tooltips" data-placement="top" data-title="Decline" ontouchstart="n_project_decline('+t[o].project_id+')" style="width:50px;">X</button>',e+="</div>",e+="</div>",e+="</div>",e+="</li>"}}else document.getElementById("notif_prj_count").innerHTML=""}}).done(function(){$("#notif_prj_holder").html(e),$(".dropdown-menu .dv-notif").click(function(e){e.stopPropagation()})})}function gettasknotiflist(){var e="";$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/notification/tasks",data:{sid:ses_id},success:function(t){if(t.length>0){prjnotif=t.length,document.getElementById("notif_task_count").innerHTML=t.length;for(var o=0;o<t.length;o++){var a=getprofpic(t[o].actor_id),s=t[o].content.replace(t[o].actor_name,"");e+='<li id="notif_task_'+t[o].task_id+'">',e+='<div class="dv-notif new">',e+='<img src="data:image/gif;base64,'+a+'" class="img-circle" width="60" height="60"  alt="Image" />',e+='<div class="dv-info">',e+='<span class="name">'+t[o].actor_name+"</span>",e+='<span class="msg">'+s+"</span>",e+="<span><a ></a></span>",e+='<span class="n-time">'+t[o].timestamp+"</span>",e+='<div class="pull-right options btn-group">',e+='<button class="btn btn-success btn-xs tooltips" data-placement="top" data-title="Accept" ontouchstart="n_task_accept('+t[o].task_id+')" style="width:50px;"><span class="flaticon-check"></span></button>',e+='<button class="btn btn-default btn-xs tooltips" data-placement="top" data-title="Decline" ontouchstart="n_task_decline('+t[o].task_id+')" style="width:50px;">X</button>',e+="</div>",e+="</div>",e+="</div>",e+="</li>"}}else document.getElementById("notif_task_count").innerHTML=""}}).done(function(){$("#notif_task_holder").html(e),$(".dropdown-menu .dv-notif").click(function(e){e.stopPropagation()})})}function notif_click(e){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/notification/notif_click/"+e,data:{sid:ses_id},success:function(){jQuery("#notif-info-"+e).removeClass("un-read")},error:function(e){console.log(e.message)}})}function notification_remove_count(){cur_notifcount>0&&($("#notif_gen_count").html(""),$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/notification/notif_remove_count",data:{sid:ses_id},success:function(){},error:function(e){console.log(e.message)}}))}function n_task_accept(e){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/task/accept_member/"+e,data:{sid:ses_id},success:function(e){1==e.status&&gettasknotiflist()},error:function(e){console.log(e.message)}})}function n_project_accept(e){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/accept_member/"+e,data:{sid:ses_id},success:function(e){1==e.status&&getprojectnotiflist()},error:function(e){console.log(e.message)}})}function getprofpic(e){var t="";return $.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user",data:{sid:ses_id,id:e},success:function(e){t=e.preview_pic},error:function(e){console.log(e.message)}}),t}function pushnotification(){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/notification",data:{sid:ses_id},success:function(e){notifid=e[0].id,mess=e[0].description}});var e=(new Date).getTime(),t=new Date(e+5e3);window.plugin.notification.local.add({id:notifid,title:"TeamStorm App",message:mess,badge:1,icon:"file://favicon.png",autoCancel:!0,sound:"beep.caf",date:t})}function getproject(){var e='<li><a data-toggle="modal" href="#newproject" ontouchstart="newproject();" ><i class="flaticon-folder-plus"></i> Create New Project</a></li>',t=0;$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/getlist",data:{sid:ses_id},success:function(o){t=o.length;for(var a=0;a<o.length;a++){var s=o[a].id,n=o[a].project_title;e+='<li><a data-toggle="collapse" href="#collapse-projects-task-lists-'+s+'" ><i class="flaticon-folder-open" ></i>'+n,gettasklist(s),e+='<i class="flaticon-menu pull-right"></i></a>',e+='<ul id="collapse-projects-task-lists-'+s+'" class="panel-collapse collapse">',e+='<li><a data-toggle="modal" href="#projectinfo"  ontouchstart="projectinfo('+s+');"  ><span class="flaticon-folder-open-line"> </span> Project Info</a></li>',e+='<li><a data-toggle="modal" href="#newtask"  ontouchstart="new_task('+s+');"  ><span class="glyphicon glyphicon-plus-sign"> </span> Add New Task</a></li>';for(var i=0;numoftask>i;i++)e+="<li><a id="+alltaskid[i]+' data-toggle="modal" href="#taskinfo"  ontouchstart="getmytaskinfo('+s+","+alltaskid[i]+')"  ><span class="flaticon-task"> </span> '+alltaskname[i]+"</a></li>";e+="</ul>",e+="</li>"}e+='<li><a data-toggle="modal" href="#project" ontouchstart="getprojectlist();"><i class="flaticon-folder-close-line"></i>See All</a>',e.length>0&&(window.localStorage.getprojects=e)},error:function(e){console.log(e.message)}}),document.getElementById("collapse-projects-lists").innerHTML=window.localStorage.getItem("getprojects"),document.getElementById("list_prj_cont").innerHTML="("+t+")"}function getmytask(){var e="",t=0;$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/task/get_active",data:{sid:ses_id},success:function(o){t=o.length;for(var a=0;a<o.length;a++){var s=o[a].id,n=o[a].task_title,i=o[a].project_id;e+='<li><a id="mytask-'+s+'"  data-toggle="modal" href="#taskinfo" ontouchstart="getmytaskinfo('+i+","+s+')"   ><span class="flaticon-task"> </span> '+n+"</a></li>",mytask[a]=s}window.localStorage.getmytask=e.length>0?e:""},error:function(e){console.log(e.message)}}),document.getElementById("collapse-tasks").innerHTML=window.localStorage.getItem("getmytask"),document.getElementById("list_mytsk_count").innerHTML="("+t+")"}function getmytaskinfo(e,t){checkConnection()>2?(cur_tid=t,$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/tasklist/"+e,data:{sid:ses_id},beforeSend:function(){preloading2()},success:function(o){if(1==o.status)for(var a=0;a<o.items.length;a++)if(cur_tid==o.items[a].id){var s,n=o.items[a].task_title,i=o.items[a].task_description,l=o.items[a].task_creator_id,c=o.items[a].task_creator_name,d=o.items[a].priority,r=o.items[a].date_start,m=o.items[a].date_end,p=o.items[a].date_completed,u=o.items[a].task_status,g=o.items[a].dependent_taskid;switch(document.getElementById("taskinfo_title").innerHTML='<span class="flaticon-task"> </span>'+n,document.getElementById("taskinfo_desc").innerHTML=i,document.getElementById("taskmaster_inf").innerHTML='<label>Task Master  <a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+l+');"><span data-toggle="modal" href="#taskinfo"> '+c+" </span></a></label>",d){case"1":s='<label style=" color:white; background:#aeafb1">Low</label>';break;case"2":s='<label style=" color:white; background:#2bbce0">Normal</label>';break;case"3":s='<label style=" color:white; background:#e73c3c">High</label>'}document.getElementById("priority_inf").innerHTML="<label>Priority  </label> "+s,proj_creator(e)==localStorage.getItem("ts_myid")?(document.getElementById("t_request").style.display="block",document.getElementById("btn_taskcomplete").disabled=!1,document.getElementById("btn_taskedit").disabled=!1,document.getElementById("btn_taskdelete").disabled=!1):(document.getElementById("t_request").style.display="none",document.getElementById("btn_taskcomplete").disabled=!0,document.getElementById("btn_taskedit").disabled=!0,document.getElementById("btn_taskdelete").disabled=!0),posttask(e,t,n),$.inArray(o.items[a].id,mytask)>-1?(document.getElementById("btn_addtask_leavetask").innerHTML="Leave Task",ismytask=1):(document.getElementById("btn_addtask_leavetask").innerHTML='<i class="glyphicon glyphicon-plus-sign"></i> Add to my Task',ismytask=0),"completed"==u?(document.getElementById("btn_taskcomplete").disabled=!0,document.getElementById("taskdate_inf").innerHTML='<div class="sub-title-task">Completed since '+p+"</div>",document.getElementById("taskstat_inf").innerHTML='<label><span  class="flaticon-Check"> </span> Task Completed</label>'):(document.getElementById("btn_taskcomplete").disabled=!1,document.getElementById("taskdate_inf").innerHTML='<div class="sub-title-task">'+r+" - "+m+"</div>",document.getElementById("taskstat_inf").innerHTML='<label><span  class="flaticon-project"> </span> Active</label>'),onedit_id=o.items[a].id,onedit_title=n,onedit_description=i,onedit_priority=d,onedit_start_date=r,onedit_end_date=m,onedit_task_status=u,onedit_dependent=g,cur_pid=e}},error:function(e){console.log(e.message)}}),gettaskmembers(t),getrequesttask(t),document.getElementById("taskhdr").innerHTML=proj_inf(e)):navigator.notification.alert("Network Connection Error Kindly Check your Internet Connection",alertDismissed,"TeamStorm App","Ok")}function writejsonfile(){var e="json/events.json",t={date:"2015-05-20 17:30:00",type:"meeting",title:"Test1",description:" For Test Only"};$.ajax({type:"POST",url:e,data:t,success:function(){},failure:function(){}})}function conf_complete_task(){navigator.notification.confirm('Are you sure to want to set this task to "Complete"?',settaskcomplete,"Confirmation Message",["Ok","Cancel"])}function settaskcomplete(e){1==e&&$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/task/complete/"+cur_tid,data:{sid:ses_id},beforeSend:function(){preloading2()},success:function(e){1==e.status&&(navigator.notification.alert("Task Completed",alertDismissed,"TeamStorm App","Ok"),getmytaskinfo(cur_pid,cur_tid),document.getElementById("btn_taskcomplete").disabled=!0,getmytask(),getproject())},error:function(e){console.log(e.message)}})}function onedittask(){isnewtask=0,document.getElementById("txt_tasktitle").value=onedit_title,document.getElementById("select_priority").value=onedit_priority,document.getElementById("txt_taskdesc").value=onedit_description,document.getElementById("txt_startdate").value=onedit_start_date,document.getElementById("txt_duedate").value=onedit_end_date,dependanttask_select(),document.getElementById("select_deptask").value=onedit_dependent,document.getElementById("fortaskmembers").innerHTML="",document.getElementById("viewnewtaskhdr").innerHTML="Edit Task",document.getElementById("divtaskmemlist").style.display="None"}function add_leave_task(){ismytask>0?navigator.notification.confirm("Are you sure to want to leave this task?",leave_task,"Confirmation Message",["Ok","Cancel"]):$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/task/join/"+onedit_id,data:{sid:ses_id},beforeSend:function(){preloading2()},success:function(e){1==e.status?(document.getElementById("btn_addtask_leavetask").innerHTML="Leave Task",ismytask=1,getmytask()):document.getElementById("btn_addtask_leavetask").innerHTML="Requesting"},error:function(e){console.log(e.message)}})}function leave_task(e){1==e&&$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/task/leave/"+onedit_id,data:{sid:ses_id},beforeSend:function(){preloading2()},success:function(e){1==e.status&&(document.getElementById("btn_addtask_leavetask").innerHTML='<i class="glyphicon glyphicon-plus-sign"></i> Add to my Task',ismytask=0,getmytask())},error:function(e){console.log(e.message)}})}function conf_delete_task(){navigator.notification.confirm("Are you sure to delete this task?",delete_task,"Confirmation Message",["Ok","Cancel"])}function testmodal(){$("#taskinfo").modal("hide")}function delete_task(e){1==e&&$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/task/delete/"+cur_tid,data:{sid:ses_id},beforeSend:function(){preloading2()},success:function(e){1==e.status&&(navigator.notification.alert("Task deleted",alertDismissed,"TeamStorm App","Ok"),getmytask(),getproject())},error:function(e){console.log(e.message)}})}function projectinfo(e){checkConnection()>2?(cur_pid=e,$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/info/"+cur_pid,data:{sid:ses_id},beforeSend:function(){preloading2()},success:function(e){if(1==e.status){var t=0,o=e.data[t].creator_id,a=e.data[t].creator_name,s=e.data[t].creator_email,n=e.data[t].title,i=e.data[t].project_description,l=e.data[t].members,c=e.data[t].tasks,d=e.data[t].posts,r=e.data[t].files;document.getElementById("prjhdr").innerHTML=n,document.getElementById("projectinfo_title").innerHTML='<span class="flaticon-folder-open"> </span>'+n,document.getElementById("projectinfo_desc").innerHTML=i,document.getElementById("PLname_inf").innerHTML='<a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+o+');"><span data-toggle="modal" href="#projectinfoprojectinfoprojectinfo">'+a+"</a>",document.getElementById("PLemail_inf").innerHTML=s,document.getElementById("taskcount_inf").innerHTML='<span class="flaticon-task"> </span>'+c+" Tasks",document.getElementById("membercount_inf").innerHTML='<span class="flaticon-user"> </span>'+l+" Mebers",document.getElementById("postcount_inf").innerHTML='<span class="flaticon-comment"> </span>'+d+" Posts",document.getElementById("filescount_inf").innerHTML='<span class="flaticon-folder-open-line"> </span>'+r+" Files",document.getElementById("userpicPL_inf").src="data:image/gif;base64,"+prjleaderpic(o),o==localStorage.getItem("ts_myid")?(document.getElementById("btn_projectdelete").disabled=!1,document.getElementById("btn_projectedit").disabled=!1,document.getElementById("btn_projectcomplete").disabled=!1):(document.getElementById("btn_projectdelete").disabled=!0,document.getElementById("btn_projectedit").disabled=!0,document.getElementById("btn_projectcomplete").disabled=!0),document.getElementById("txt_editprj_name").value=n,document.getElementById("txt_editprj_desc").value=i,document.getElementById("select_editprj_privacy").value="0",projectmembers(cur_pid)}},error:function(e){console.log(e.message)}}).done(function(){})):navigator.notification.alert("Network Connection Error Kindly Check your Internet Connection",alertDismissed,"TeamStorm App","Ok")}function projectmembers(e){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/memberlist/"+e,data:{sid:ses_id},success:function(e){var t="";if(1==e.status){for(var o=0;o<e.items.length;o++){var a=e.items[o].id,s=e.items[o].role,n=e.items[o].name,i=e.items[o].profile_pic;t+='<tr class="checked-list">',t+='<td><div class="portrait-status chat"><a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+a+');"  ><img  src="'+i+'" height="45" width="45" class="img-circle"></a></div>',t+='<td><a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+a+');"><i data-toggle="modal" href="#newproject" ></i>'+n+'</a><p style="font-size:10px;">'+s+'</p></td></td><td><div class="checkbox" name="chk_members" ></div></td></tr>'}document.getElementById("prj-member").innerHTML=t}},error:function(e){console.log(e.message)}})}function conf_archive_project(){navigator.notification.confirm("Complete this project and move to archive?",archive_project,"Archive Project",["Ok","Cancel"])}function archive_project(e){1==e&&$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/archive/"+cur_pid,data:{sid:ses_id},beforeSend:function(){preloading2()},success:function(e){1==e.status&&(navigator.notification.alert("Project is now in Archive",alertDismissed,"TeamStorm App","Ok"),projectinfo(cur_pid),getmytask(),getproject())},error:function(e){console.log(e.message)}})}function edit_project(){var e=document.getElementById("txt_editprj_name").value,t=document.getElementById("txt_editprj_desc").value,o=document.getElementById("select_editprj_privacy").value,a=document.getElementById("chk_editprj_taskapproval").checked;$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/edit/"+cur_pid,data:{sid:ses_id,title:e,description:t,privacy:o,task_approval:a},beforeSend:function(){preloading2()},success:function(e){1==e.status&&(clearprj_text(),getproject(),navigator.notification.alert("Project Updated",alertDismissed,"TeamStorm App","Ok"),projectinfo(cur_pid))},error:function(e){console.log(e.message)}})}function prjleaderpic(e){var t="";return $.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user",data:{sid:ses_id,id:e},success:function(e){t=e.preview_pic},error:function(e){console.log(e.message)}}),t}function conf_delete_project(){navigator.notification.confirm("Are you sure to delete this project? this will delete all tasks, files, users and coversations. continue?",delete_project,"Delete Project",["Ok","Cancel"])}function delete_project(e){1==e&&$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/delete/"+cur_pid,data:{sid:ses_id},beforeSend:function(){preloading2()},success:function(e){1==e.status&&(navigator.notification.alert("Project deleted",alertDismissed,"TeamStorm App","Ok"),getmytask(),getproject())},error:function(e){console.log(e.message)}})}function gettasklist(e){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/tasklist/"+e,data:{sid:ses_id},success:function(e){if(1==e.status){numoftask=e.items.length;for(var t=0;t<e.items.length;t++)alltaskid[t]=e.items[t].id,alltaskname[t]=e.items[t].task_title}},error:function(e){console.log(e.message)}})}function getprojectlist(){preloading3();var e="";$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/getlist",data:{sid:ses_id},success:function(t){for(var o=0;o<t.length;o++){var a,s,n,i=t[o].id,l=t[o].project_title,c=t[o].date_created,d="'"+l+"'";a=c.split("-"),s=a[2].split(" "),months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=months[a[1]-1]+" "+s[0]+", "+a[0],e+='<div class="inner-wrapper"><div class="task-wrapper"><div class=" left-border" style="width:100%"><div class="title-task"><a data-toggle="modal" href="#projectinfo" data-role="button" type="button" ontouchstart="projectinfo('+i+');" ><span data-toggle="modal" href="#project">'+l+'</span></a></div><div class="sub-title-task">Date Created: '+n+"</div>",e+='<div class="project-status"><ul class="clearfix"><li><div class="title" ><a data-toggle="modal" href="#task" data-role="button" type="button" ontouchstart="loadtask('+d+","+i+');"><span data-toggle="modal" href="#project" style="margin: 0 0 0px;"></span>Tasks</a></div></li><li><div class="stats">Active</div><div class="count">'+getcounttask(i,"active")+'</div></li><li><div class="stats">Pending</div><div class="count">'+getcounttask(i,"pending")+'</div></li><li><div class="stats">Completed</div><div class="count">'+getcounttask(i,"completed")+"</div></li></ul></div>",e+='<div class="task-user"><ul>',get_proj_member(i);for(var r=0;numofmembers>r;r++)e+='<li><a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+allmemberid[r]+');"><img data-toggle="modal" href="#project" class="img-circle" src="'+allmemberpic[r]+'" width="50" height="50" alt="Image"></a></li>';e+="</ul></div>",e+='</div><div class="right-border"><div class="link-wrapper"><a  data-role="button" type="button" class="arrow-link" data-toggle="modal" href="#newpost" onclick="postproject('+i+');"  ><span class="flaticon-arrow-right"></span><i data-toggle="modal" href="#project"><i/></a></div></div></div></div>'}},error:function(e){console.log(e.message)}}).done(function(){document.getElementById("projectlist").innerHTML=e,stopload()}).fail(function(e){console.log(e.message)})}function postproject(e){loadprojects_select(),clearposttext(),document.getElementById("divselectproject").style.display="block",document.getElementById("select_projlists").value=e,document.getElementById("searchpostuser").style.display="none"}function posttask(e,t,o){clearposttext(),document.getElementById("divselectproject").style.display="none",document.getElementById("searchpostuser").style.display="none",document.getElementById("tasknamepost").innerHTML='Post to Task  <span class="flaticon-task"> </span>'+o,document.getElementById("txtposttotaskid").value=t,document.getElementById("txtposttotaskprjid").value=e}function proj_inf(e){var t="";return $.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/info/"+e,data:{sid:ses_id},success:function(e){1==e.status&&(proj_completed=e.data[0].is_completed,t=e.data[0].title)},error:function(e){console.log(e.message)}}),t}function proj_creator(e){var t=0;return $.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/info/"+e,data:{sid:ses_id},success:function(e){1==e.status&&(t=e.data[0].creator_id)},error:function(e){console.log(e.message)}}),t}function get_proj_member(e){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/memberlist/"+e,data:{sid:ses_id},success:function(e){if(1==e.status){numofmembers=0;for(var t=0;t<e.items.length;t++)("Project Leader"==e.items[t].role||"Co Leader"==e.items[t].role)&&(allmemberid[numofmembers]=e.items[t].id,allmemberpic[numofmembers]=e.items[t].profile_pic,numofmembers+=1)}},error:function(e){console.log(e.message)}})}function getprofpic(e){var t="img/user/thumb-user-medium.jpg";return $.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user",data:{sid:ses_id,id:e},success:function(e){t=e.preview_pic
},error:function(e){console.log(e.message)}}),t}function clearprj_text(){document.getElementById("txt_prj_name").value="",document.getElementById("txt_prj_desc").value="",document.getElementById("txt_editprj_name").value="",document.getElementById("txt_editprj_desc").value="",document.getElementById("select_editprj_privacy").value=0}function getcounttask(e,t){var o=0;return $.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/tasklist/"+e,data:{sid:ses_id,sort:t},success:function(e){1==e.status&&(o=e.items.length)},error:function(e){console.log(e.message)}}),o}function loadtask(e,t){document.getElementById("viewtaskhdr").innerHTML=e+"-Task List",cur_pid=t,document.getElementById("active-task").innerHTML="",document.getElementById("pending-task").innerHTML="",document.getElementById("completed-task").innerHTML="",gettaskactive(),gettaskcompleted(),gettaskpending(),document.getElementById("viewnewtaskhdr").innerHTML=e+"-Create Task",$.when().then(function(){})}function gettaskactive(){var e="",t="active";document.getElementById(""+t+"-task").innerHTML="",$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/tasklist/"+cur_pid,data:{sid:ses_id,sort:t},beforeSend:function(){preloading2()},success:function(o){if(1==o.status)for(var a=0;a<o.items.length;a++){var s=o.items[a].id,n=o.items[a].task_title,i=o.items[a].priority,l="'"+n+"'";switch(e+='<div id="task-'+s+'" class="inner-wrapper"> <div class="task-wrapper"><div class="left-border" style="width:100%;"><div class="title-task"><a data-toggle="modal" href="#taskinfo"  ontouchstart="getmytaskinfo('+cur_pid+","+s+');"> <i data-toggle="modal" href="#task"><i/>'+n+"</a></div>",i){case"1":e+='<label style=" color:white; background:#aeafb1">Low</label>';break;case"2":e+='<label style=" color:white; background:#2bbce0">Normal</label>';break;case"3":e+='<label style=" color:white; background:#e73c3c">High</label>'}gettaskmemberspic(s),e+='<div class="task-user"><ul>';for(var c=0;numtaskmem>c;c++)e+='<li><a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+taskmemid[c]+');"><img data-toggle="modal" href="#task" class="img-circle" src="data:image/gif;base64,'+taskmempic[c]+'" width="50" height="50" width="50" alt="Image"></a></li>';e+="</ul></div></div>",e+='<div class="right-border"><div class="link-wrapper"> <a class="arrow-link"><span class="flaticon-arrow-right"  data-toggle="modal" href="#newpost" ontouchstart="posttask('+cur_pid+","+s+","+l+');" ></span></a></div></div></div></div>'}document.getElementById(""+t+"-task").innerHTML=e.length>0?e:""},error:function(e){console.log(e.message)}})}function gettaskpending(){var e="",t="pending";document.getElementById(""+t+"-task").innerHTML="",$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/tasklist/"+cur_pid,data:{sid:ses_id,sort:t},beforeSend:function(){preloading2()},success:function(o){if(1==o.status)for(var a=0;a<o.items.length;a++){var s=o.items[a].id,n=(o.items[a].dependent_taskid,o.items[a].task_title),i=(o.items[a].task_description,o.items[a].task_creator_id,o.items[a].task_creator_name,o.items[a].priority),l=(o.items[a].date_created,o.items[a].date_start,o.items[a].date_end,o.items[a].date_completed,o.items[a].task_status,"'"+n+"'");switch(e+='<div id="task-'+s+'" class="inner-wrapper"> <div class="task-wrapper"><div class="left-border" style="width:100%;"><div class="title-task"><a data-toggle="modal" href="#taskinfo"  ontouchstart="getmytaskinfo('+cur_pid+","+s+');"> <i data-toggle="modal" href="#task"><i/>'+n+"</a></div>",i){case"1":e+='<label style=" color:white; background:#aeafb1">Low</label>';break;case"2":e+='<label style=" color:white; background:#2bbce0">Normal</label>';break;case"3":e+='<label style=" color:white; background:#e73c3c">High</label>'}gettaskmemberspic(s),e+='<div class="task-user"><ul>';for(var c=0;numtaskmem>c;c++)e+='<li><a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+taskmemid[c]+');"><img data-toggle="modal" href="#task" class="img-circle" src="data:image/gif;base64,'+taskmempic[c]+'" width="50" height="50" width="50" alt="Image"></a></li>';e+="</ul></div></div>",e+='<div class="right-border"><div class="link-wrapper"> <a  class="arrow-link"><span class="flaticon-arrow-right" data-toggle="modal" href="#newpost" ontouchstart="posttask('+cur_pid+","+s+","+l+');"></span></a></div></div></div></div>'}document.getElementById(""+t+"-task").innerHTML=e.length>0?e:""},error:function(e){console.log(e.message)}})}function gettaskcompleted(){var e="",t="completed";document.getElementById(""+t+"-task").innerHTML="",$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/tasklist/"+cur_pid,data:{sid:ses_id,sort:t},beforeSend:function(){preloading2()},success:function(o){if(1==o.status)for(var a=0;a<o.items.length;a++){var s=o.items[a].id,n=(o.items[a].dependent_taskid,o.items[a].task_title),i=(o.items[a].task_description,o.items[a].task_creator_id,o.items[a].task_creator_name,o.items[a].priority),l=(o.items[a].date_created,o.items[a].date_start,o.items[a].date_end,o.items[a].date_completed,o.items[a].task_status,"'"+n+"'");switch(e+='<div id="task-'+s+'" class="inner-wrapper"> <div class="task-wrapper"><div class="left-border" style="width:100%;"><div class="title-task"><a data-toggle="modal" href="#taskinfo"  ontouchstart="getmytaskinfo('+cur_pid+","+s+');"> <i data-toggle="modal" href="#task" ><i/>'+n+"</a></div>",i){case"1":e+='<label style=" color:white; background:#aeafb1">Low</label>';break;case"2":e+='<label style=" color:white; background:#2bbce0">Normal</label>';break;case"3":e+='<label style=" color:white; background:#e73c3c">High</label>'}gettaskmemberspic(s),e+='<div class="task-user"><ul>';for(var c=0;numtaskmem>c;c++)e+='<li><a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+taskmemid[c]+');"><img data-toggle="modal" href="#task" class="img-circle" src="data:image/gif;base64,'+taskmempic[c]+'" width="50" height="50" width="50" alt="Image"></a></li>';e+="</ul></div></div>",e+='<div class="right-border"><div class="link-wrapper"> <a  class="arrow-link"><span class="flaticon-arrow-right" data-toggle="modal" href="#newpost" ontouchstart="posttask('+cur_pid+","+s+","+l+');"></span></a></div></div></div></div>'}document.getElementById(""+t+"-task").innerHTML=e.length>0?e:""},error:function(e){console.log(e.message)}})}function gettaskmemberspic(e){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/task/members/"+e,data:{sid:ses_id},success:function(e){if(1==e.status){numtaskmem=e.items.length;for(var t=0;t<e.items.length;t++)taskmemid[t]=e.items[t].id,taskmempic[t]=e.items[t].profile_pic}},error:function(e){console.log(e.message)}})}function getrequesttask(e){var t="";$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/task/member_requests/"+e,data:{sid:ses_id},success:function(o){if(1==o.status)for(var a=0;a<o.items.length;a++){var s=o.items[a].id,n=o.items[a].display_name,i=o.items[a].email,l=o.items[a].profile_pic,c=o.items[a].user_id;t+='<tr class="checked-list">',t+='<td><div class="portrait-status chat"><a  ><img data-toggle="modal" href="#newtask" src="data:image/gif;base64,'+l+'" height="45" width="45" class="img-circle"></a></div>',t+='<td><a ><i data-toggle="modal" href="#userprof" ontouchstart="userprofile('+s+');" ></i>'+n+'</a><p style="font-size:10px;"><i class="flaticon-email" > '+i+'</i></p></td></td><td><div class="checkbox" name="chk_members" ><span class="actions"><div class="options btn-group"><button class="btn btn-success btn-xs tooltips" data-title="Accept" data-original-title="" title="" ontouchstart="accept_taskrequest('+e+","+c+');"  ><span class="flaticon-check"></span></button><button  class="btn btn-default btn-xs tooltips" data-title="Decline" data-original-title="" title="" ontouchstart="cancel_taskrequest('+e+","+c+');" >X</button></div></span></div></td></tr>'}},error:function(e){console.log(e.message)}}),document.getElementById("task-request-list").innerHTML=t}function accept_taskrequest(e,t){req_tid=e,req_uid=t,navigator.notification.confirm("Are you sure you want to accept this task request?",acceptmembertask,"Confirmation Message",["Ok","Cancel"])}function acceptmembertask(e){1==e&&$.ajax({type:"get",url:"http://teamstormapps.host/tasks/accept_member/"+req_tid+"/"+req_uid,data:{},success:function(e){1==e.success?(getrequesttask(req_tid),gettaskmembers(req_tid)):navigator.notification.alert("Network Connection Error Kindly Check your Internet Connection",alertDismissed,"TeamStorm App","Ok")}})}function cancel_taskrequest(e,t){req_tid=e,req_uid=t,navigator.notification.confirm("Are you sure you want to decline this task request?",declinemembertask,"Confirmation Message",["Ok","Cancel"])}function declinemembertask(e){1==e&&$.ajax({type:"get",url:"http://teamstormapps.host/tasks/decline_member/"+req_tid+"/"+req_uid,data:{},success:function(e){1==e.success?getrequesttask(req_tid):navigator.notification.alert("Network Connection Error Kindly Check your Internet Connection",alertDismissed,"TeamStorm App","Ok")}})}function gettaskmembers(e){var t="";$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/task/members/"+e,data:{sid:ses_id},success:function(o){if(1==o.status)for(var a=0;a<o.items.length;a++){{var s=o.items[a].id,n=o.items[a].user_id,i=(o.items[a].project_id,o.items[a].assigned_by,o.items[a].display_name),l=o.items[a].email;o.items[a].profile_pic}t+='<tr class="checked-list" id="task-assigned-'+s+'">',t+='<td><div class="portrait-status chat"><a  ><img data-toggle="modal" href="#userprof" ontouchstart="userprofile('+n+');" src="data:image/gif;base64,'+getprofpic(n)+'" height="45" width="45" class="img-circle"></a></div>',t+='<td><a  ><i data-toggle="modal" href="#userprof" ontouchstart="userprofile('+n+');" ></i>'+i+'</a><p style="font-size:10px;"><i class="flaticon-email" > '+l+'</i></p></td></td><td><div class="checkbox" name="chk_members" ><button type="button" class="close" ontouchstart="delete_assignedtask('+s+","+e+","+n+')">Ã—</button></div></td></tr>'}},error:function(e){console.log(e.message)}}),document.getElementById("task-assigned-list").innerHTML=t}function delete_assignedtask(e,t,o){del_assid=e,del_tid=t,del_uid=o,navigator.notification.confirm("Are you sure you want to remove this user from task?",delete_taskmember,"Confirmation Message",["Ok","Cancel"])}function delete_taskmember(e){1==e&&$.ajax({type:"post",async:!0,dataType:"json",url:"http://teamstormapps.host/mobile/task/remove_member/"+del_tid+"/"+del_uid,data:{sid:ses_id},beforeSend:function(){preloading2()},success:function(e){if(1==e.status){var t=document.getElementById("task-assigned-list"),o=document.getElementById("task-assigned-"+del_assid);t.removeChild(o)}},error:function(e){console.log(e.message)}})}function gettaskprofpic(e){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user",data:{sid:ses_id,id:e},success:function(e){task_mem_profpic=e.preview_pic},error:function(e){console.log(e.message)}})}function create_project(){var e=document.getElementById("txt_prj_name").value,t=document.getElementById("txt_prj_desc").value,o=document.getElementById("txtmember").value;$.ajax({type:"post",async:!0,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/create",data:{sid:ses_id,name:e,description:t,members:o},beforeSend:function(){preloading2()},success:function(e){1==e.status&&(clearprj_text(),getproject(),navigator.notification.alert("New Project Created",alertDismissed,"TeamStorm App","Ok"),getmytask())},error:function(e){console.log(e.message)}})}function new_task(e){isnewtask=1,cur_pid=e,cleartsk_text(),preloading2(),dependanttask_select(),get_proj_mem_for_task(),document.getElementById("viewnewtaskhdr").innerHTML="Create Task",document.getElementById("divtaskmemlist").style.display="Block"}function dependanttask_select(){var e='<option value="0">None</option>';$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/tasklist/"+cur_pid,data:{sid:ses_id,sort:"active"},success:function(t){if(1==t.status)for(var o=0;o<t.items.length;o++)e+='<option value="'+t.items[o].id+'">'+t.items[o].task_title+"</option>"},error:function(e){console.log(e.message)}}),window.localStorage.dependanttask=e,document.getElementById("select_deptask").innerHTML=window.localStorage.getItem("dependanttask")}function get_proj_mem_for_task(){var e="";$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/project/memberlist/"+cur_pid,data:{sid:ses_id},success:function(t){if(1==t.status)for(var o=0;o<t.items.length;o++){var a=t.items[o].id,s=(t.items[o].role,t.items[o].email),n=t.items[o].name,i=t.items[o].profile_pic;e+='<tr class="checked-list">',e+='<td><div class="portrait-status chat"><a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+a+');" ><img data-toggle="modal" href="#newtask" src='+i+' height="45" width="45" class="img-circle"></a></div>',e+='<td><a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+a+');"><i data-toggle="modal" href="#newtask" ></i>'+n+'</a><p style="font-size:10px;"><i class="flaticon-email" > '+s+'</i></p></td></td><td><div class="checkbox" name="chk_members" ><input type="checkbox" id="flat-checkbox-1" name="chk_members" class="icheckbox_flat" value="'+a+'"></div></td></tr>'}},error:function(e){console.log(e.message)}}),document.getElementById("fortaskmembers").innerHTML=e.length>0?e:""}function getmemprofpic(e){$.ajax({type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/user",data:{sid:ses_id,id:e},success:function(e){task_mem_profpic1=e.preview_pic},error:function(e){console.log(e.message)}})}function changedateformat(e){var t,o;return t=e.split("/"),o=t[2]+"-"+t[0]+"-"+t[1]}function create_task(){for(var e=getCheckedBoxes("chk_members"),t="",o=0;o<e.length;o++)t+=e[o].value+",";t=t.slice(0,-1);var a=document.getElementById("txt_tasktitle").value,s=document.getElementById("select_priority").value,n=document.getElementById("txt_taskdesc").value,i=document.getElementById("txt_startdate").value,l=document.getElementById("txt_duedate").value,c=document.getElementById("select_deptask").value;$.ajax(isnewtask>0?{type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/task/create",data:{sid:ses_id,project_id:cur_pid,title:a,description:n,startdate:i,duedate:l,priority:s,members:t,dependent:c},success:function(e){1==e.status&&(cleartsk_text(),getproject())},error:function(e){console.log(e.message)}}:{type:"post",async:!1,global:!1,cache:!1,dataType:"json",url:"http://teamstormapps.host/mobile/task/edit/"+onedit_id,data:{sid:ses_id,project_id:cur_pid,title:a,description:n,priority:s,dependent:c},success:function(e){1==e.status&&(cleartsk_text(),getmytaskinfo(cur_pid,cur_tid),getmytask(),getproject())},error:function(e){console.log(e.message)}})}function getCheckedBoxes(e){for(var t=document.getElementsByName(e),o=[],a=0;a<t.length;a++)t[a].checked&&o.push(t[a]);return o.length>0?o:""}function cleartsk_text(){var e=new Date,t=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()+" "+e.getHours()+":"+e.getMinutes();document.getElementById("txt_tasktitle").value="",document.getElementById("select_priority").value="",document.getElementById("txt_taskdesc").value="",document.getElementById("txt_startdate").value=t,document.getElementById("txt_duedate").value=t,document.getElementById("select_deptask").value=""}function newproject(){member_search(),document.getElementById("txt_prj_name").value="",document.getElementById("txt_prj_desc").value="",document.getElementById("txtmember").value="",document.getElementById("search-prj-member").innerHTML=""}function member_search(){$(".txt-search-member").keyup(function(){$(".mem-list .mem-list-content .mem-list-info-name ").each(function(){$(this).text().toLowerCase().search($(".txt-search-member").val().toLowerCase())>-1?$(this).parent().parent().fadeIn(200):$(this).parent().parent().fadeOut(200)})});var e="http://teamstormapps.host/";$("#txt_prj_emailadd").autocomplete({source:e+"search/member",selectFirst:!0,autoFocus:!0,search:function(){$(".btn-proj-add-member > span").removeClass("fa-search").addClass("fa-spinner fa-spin"),$(".btn-proj-add-member > span").click(function(){return!1})},response:function(e,t){$(".btn-proj-add-member > span").addClass("fa-plus").removeClass("fa-spinner fa-spin"),$(".no-result").text(t.content.length?"":"No match found.")},select:function(t,o){var a="'"+o.item.email+"'",s=document.getElementById("txtmember").value,n=s.split(",");if(o.item.email==window.localStorage.getItem("username"))navigator.notification.alert("You cannot add yourself!.",alertDismissed,"TeamStorm App","Ok");else if($.inArray(o.item.email,n)>-1)navigator.notification.alert(o.item.email+" is already in the list.",alertDismissed,"TeamStorm App","Ok");else{var i;i='<tr class="checked-list">',i+='<td><div class="portrait-status chat"><a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+o.item.id+');"  ><img data-toggle="modal" href="#newproject" src="'+e+"thumbs/profile?id="+o.item.id+"&hash="+o.item.image+'" height="45" width="45" class="img-circle"></a></div>',i+='<td><a data-toggle="modal" href="#userprof" ontouchstart="userprofile('+o.item.id+');"><i data-toggle="modal" href="#newproject" ></i>'+o.item.fullname+'</a><p style="font-size:10px;"><i class="flaticon-email" > '+o.item.email+'</i></p></td></td><td><div class="checkbox" name="chk_members" ><span class="actions"><div class="options btn-group"><button  class="btn btn-default btn-xs tooltips" data-title="Decline" data-original-title="" ontouchstart="delete_member('+a+')" title="">X</button></div></span></div></td></tr>';var t=document.createElement("tr");t.id="tr_"+o.item.email,t.innerHTML=i,document.getElementById("search-prj-member").insertBefore(t,document.getElementById("search-prj-member").childNodes[0]),$("#txt_prj_emailadd").val(""),document.getElementById("txtmember").value=s+","+o.item.email}return $(".btn-proj-add-member > span").removeClass("fa-search").removeClass("fa-spinner fa-spin").addClass("fa-plus"),$(".btn-proj-add-member > span").click(function(){return!0}),!1}}).focus(function(){$(this).autocomplete("search",this.value)}).data("ui-autocomplete")._renderItem=function(t,o){var a='<a href="javascript:void(0);"><img src="'+e+"thumbs/profile?id="+o.id+"&hash="+o.image+'" width="45" height="45" class="img-circle" />  <td>'+o.fullname+'</a><p style="font-size:10px;"><i class="flaticon-email" > '+o.email+"</i></p></td>";return $("<li></li>").data("item.autocomplete",o).append(a).appendTo(t)},$("#txt_prj_emailadd").keypress(function(e){13==e.which&&$(".btn-info.prj_btn_add").click()})}function delete_member(e){var t=document.getElementById("txtmember").value;document.getElementById("txtmember").value=t.replace(e+",","");var o=document.getElementById("search-prj-member"),a=document.getElementById("tr_"+e);o.removeChild(a)}var ses_id=window.localStorage.getItem("session_id"),getnfeeduname="",getnfeedprofpic="",cur_postid,cur_set_postid,cur_commentid,cur_posterid,nextpagedate,numoffeed=window.localStorage.getItem("numoffeed");document.addEventListener("deviceready",function(){load_myprofile(),document.getElementById("main_prof_fullname").innerHTML=window.localStorage.getItem("name"),document.getElementById("user_menu_profpic").src="data:image/gif;base64,"+window.localStorage.getItem("ts_myprofpic"),document.getElementById("user_comment_profpic").src="data:image/gif;base64,"+window.localStorage.getItem("ts_myprofpic"),window.localStorage.host="http://teamstormapps.host/";var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){e.responseText}},e.open("GET","http://teamstormapps.host/",!0),e.send(),1==window.localStorage.getItem("auto_signin")?(document.getElementById("streamlist").innerHTML=window.localStorage.getItem("latestnewsfeed"),call_emoticons("streamlist"),nextpagedate=window.localStorage.getItem("nextpagedate")):getnewsfeed(!1),myScroll.refresh(),getmytask(),getproject(),getprojectlist(),loadprojects_select(),loadaddress()});var ses_id=window.localStorage.getItem("session_id"),curmemoid,passwordok=1,ses_id=window.localStorage.getItem("session_id");$(document).ready(function(){});var ses_id=window.localStorage.getItem("session_id"),curdate=new Date,cur_todoid,ses_id=window.localStorage.getItem("session_id"),cur_uid,cur_is_following=0;$(document).ready(function(){document.getElementById("userprof_name").innerHTML=window.localStorage.getItem("name"),document.getElementById("userprof_pic").src="data:image/gif;base64,"+window.localStorage.getItem("ts_myprofpic")});var ses_id=window.localStorage.getItem("session_id"),cur_notifcount=0,cur_notifcount2=0,first_notif_id,notifid,mess;setInterval(function(){notification_refresh()},2e4),document.addEventListener("deviceready",function(){window.plugin.notification.local.registerPermission(function(e){console.log("Permission has been granted: "+e)})},!0);var ses_id=window.localStorage.getItem("session_id"),proj_completed=0,allmemberid=new Array,allmemberpic=new Array,alltaskid=new Array,alltaskname=new Array,mytask=new Array,taskmemid=new Array,taskmempic=new Array,numtaskmem,numoftask,numofmembers,task_mem_profpic="",cur_pid,cur_tid,del_assid,del_uid,del_tid,task_mem_profpic1="",onedit_id,onedit_title,onedit_description,onedit_priority,onedit_start_date,onedit_end_date,onedit_task_status,onedit_dependent,isnewtask=0,ismytask=0,req_tid,req_uid;